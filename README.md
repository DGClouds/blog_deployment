# About dgideas.net
dgideas.net is @DGideas' personal blog. This document describe the architecture of the server behind dgideas.net, 3rd party service configuration method which the blog used and provide some useful maintance scripts which dgideas.net daily used.

## Server Configuration
dgideas.net use these tech stack on Nov, 2022:

| Concept Layer | Used Component | Extra Info |
| --- | --- | --- |
| OS | Ubuntu 22.04 LTS | |
| Blog Platform | WordPress | the newest version |
| Web Server | nginx | from `apt install` |
| Database | MariaDB | from `api install` |

Service registered on this server:
* blog_backup: see `/blog_backup`

### Initialize environment
```bash
sudo apt install php-fpm mariadb-server
```

### nginx configure
```
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass PHP scripts to FastCGI server
	#
	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
	
		# With php-fpm (or other unix sockets):
		fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
		# With php-cgi (or other tcp sockets):
		#fastcgi_pass 127.0.0.1:9000;
	}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}
```

## 3rd services
* Cloudflare: hide origin server ip address & proxy/cache/deliver webpage content & https security layer
* DGClouds OSS: host image & video attachment in blog article
* Wasabi: backup data

### Cloudflare
* an unpublished domain with `*.dgclouds.net`, which we could ssh on to server
* `dgideas.net`, `dgideas.blog` and `www.dgideas.net` which people can access blog by these url(s)
